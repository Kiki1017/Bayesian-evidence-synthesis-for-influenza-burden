---
title: Bayesian evidence synthesis for influenza burden estimation, using FluSurv-Net
  data
author: "Ivo M. Foppa"
date: "August 15, 2018"
output: pdf_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Model description

The observed influenza hospitalizations were modeled as binomial random variables generated from the (unobserved) numbers of influenza hospitalized patients and the detection probabilities. 
The total numbers of influenza hospitalized patients was modeled as Poisson random variables.
These probabilities were a function of the distribution of test types used, with assumed priors for test sensitivities and observed test results. This was done by outcome (non-fatal, fatal). The true proportion of influenza was assumed to vary by outcome, but not test type. Total in-hospital influenza mortality was modeled as Poisson random variables generated by a influenza mortality rate, multiplied by a given in-hospital death proportion (R&C in-hospital deaths/all R&C death). The US estimates were generated as Poisson random variables using the non-fatal influenza hospitalization rates plus the in-hospital influenza mortality rates (hospitalization burden) and the total influenza mortality rate (mortality burden). The model was fitted in a Bayesian framework, using the R2jags package in R. With the exception for the test sensitivities, which were assigned informative Normal or log Normal priors, if non-positive realizations would be possible, uniform priors were used.

## Results
### Model conversion
```{r,echo=FALSE,fig.show='hold',fig.width=6}

bfolder <- "C:/Users/vor1/Dropbox/Misc work/Bayesian evidence synthesis/Bayesian-evidence-synthesis-for-influenza-burden/" #this is an example ...
setwd(paste0(bfolder,'BEwriteup'))

for (ag in 1:5){

  load(paste0('codalsdiffsimpl',ag,'.RData'))

  assign(paste0('cihosp',ag), prettyNum(round(as.numeric(quantile(codalsdiffsimpl$USfluhosp,probs = c(.5,.025,.975))))))
assign(paste0('cideath',ag),prettyNum(round(as.numeric(quantile(codalsdiffsimpl$USfludeath,probs = c(.5,.025,.975))))))
}

```

### Model estimates: Comparison
The following Tables compares Melissa's point estimates to the ``point'' estimates (median) from this model:

#### Hospitalization burden

  Age group  Melissa    Model 2 
----------- --------- -----------
<5           22703     `r paste0(cihosp1[1],' (',cihosp1[2],',',cihosp1[3],')')`
5-17         18084    `r paste0(cihosp2[1],' (',cihosp2[2],',',cihosp2[3],')')`
18-49         50462   `r paste0(cihosp3[1],' (',cihosp3[2],',',cihosp3[3],')')`
50-64         79280    `r paste0(cihosp4[1],' (',cihosp4[2],',',cihosp4[3],')')`
65+           445724   `r paste0(cihosp5[1],' (',cihosp5[2],',',cihosp5[3],')')`

#### Mortality burden

  Age group  Melissa    Model 2 
----------- ---------- ---------
<5           865	     `r paste0(cideath1[1],' (',cideath1[2],',',cideath1[3],')')`
5-17         869       `r paste0(cideath2[1],' (',cideath2[2],',',cideath2[3],')')`
18-49         2475      `r paste0(cideath3[1],' (',cideath3[2],',',cideath3[3],')')`
50-64         13844     `r paste0(cideath4[1],' (',cideath4[2],',',cideath4[3],')')`
65+           58103    `r paste0(cideath5[1],' (',cideath5[2],',',cideath5[3],')')`
		
The 

